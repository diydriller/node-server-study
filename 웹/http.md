# HTTP

## 1. 버전
### HTTP 1.1
* 문자열 그대로 전송
* 매 요청마다 header 구조가 반복된다.
* persistent connection을 사용해서 일정시간동안 connection 닫지 않고 재사용한다.
* pipelining을 사용해서 다수의 요청들을 서버의 소켓 하나로 순차적으로 처리한다.
이때 뒤의 요청은 지연되는데 이를 Head Of Blocking이라고 한다.

### HTTP 2
* 문자열이 이진데이터로 인코딩되어 전송한다.
* 멀티플렉싱을 이용해서 여러 요청을 병렬로 수행한다.
프레임은 HTTP 2에서의 최소 통신단위이고 프레임이 모여서 요청응답의 단위인 메시지가 된다.
메시지는 스트림을 통해 프레임단위로 전송된다.
* 서버푸쉬를 사용해서 연관된 리소스의 경우 서버에서 요청없이 보낸다.
* 헤더압축을 사용해서 크기를 줄인다.

## 2. Header
* Keep-Alive : 특정시간동안 최대 요청수를 설정해서 connection을 유지한다.
handshaking 오버헤드를 줄일 수 있다.
* Etag : 서버 리소스의 버전을 나타내며 브라우저에 캐싱된 리소스의 etag와 서버 리소스의 etag가
같다면 서버는 리소스를 전송하지 않고 304 Not Modified로 응답해주고 브라우저는 캐시를 사용한다. 
* Cache-Control : 캐시옵션을 설정한다. 캐시를 사용하면 유효시간이 지나지 않을 경우 
디스크나 메모리에서 캐시를 읽어온다. 유효시간이 지날 경우 서버로 검증요청을 보내고 
캐시가 유효하다면 304 Not Modified로 응답을 받고 유효하지 않다면 200 OK로 응답을 받는다.
```shell
    # 캐시 사용하지 않는 경우
    # 서버로 캐시 검증요청 (매번 etag 확인) , 캐시 저장하지 않음 , 캐시 만료확인
    Cache-Control: no-cache, no-store, must-revalidate
    
    # 캐시 유효시간(초 단위)
    Cache-Control: max-age=16000
```
* Age : max-age 시간내에서 시간이 얼마나 흘렀는지 나타낸다.
* Expires : 캐시 만료시각을 나타낸다. Cache-Control의 max-age가 있으면 무시된다.
* Set-Cookie : 브라우저에게 쿠키를 저장하라는 명령이다. 쿠키는 key와 value로 이루어져있고
브라우저가 꺼지면 사라지는 session cookie와 브라우저가 꺼져도 사라지지 않는
permanent cookie가 있다.
```shell
    # https에서만 쿠키 사용가능 , 자바스크립트에서 쿠키 접근 불가능
    Set-Cookie: key=value; Secure ; HttpOnly
```

## 3. status
* 304 NOT MODIFIED : 서버 리소스의 변경사항이 없다는 의미이다. 

## 4. Https
* http body를 중간에서 가로채서 내용을 확인할 수 있으므로 암호화함으로써 보안을 강화한다.
1) 서버와 클라이언트는 handshaking 과정에서 임의의 문자열과 암호 알고리즘을 서로 교환한다.
2) 브라우저는 공인된 CA 인증기관의 공개키를 가지고 있어서 서버로부터 받은 인증서를 복호화해서
공인된 CA 인증기관으로부터 받은 인증서인지를 확인하고 서버의 공개키를 획득한다.
3) 브라우저는 앞서 주고받은 문자열로 대칭키를 만들고 앞서 획득한 서버의 공개키로 암호화해서 
서버로 전송한다.
4) 서버는 자신의 비밀키로 대칭키를 획득하고 이후에는 대칭키로 통신한다.
* 공개키/비밀키 방식은 보안적으로 더 안전하지만 암호화 연산 시간이 많이 걸리는 반면 
대칭키 방식은 보안적으로 덜 안전하지만 암호화 연산 시간이 덜 걸린다.